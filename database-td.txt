#!/bin/bash

# Set the root password for MariaDB
DB_ROOT_PASSWORD="1234"

# Set the user and password
DB_USER="td"
DB_PASSWORD="1234"

# Secure the MariaDB installation
sudo mysql_secure_installation <<EOF
${DB_ROOT_PASSWORD}
${DB_ROOT_PASSWORD}
n
y
y
y
y
EOF

# Create the user with the password
sudo mysql -u root -p${DB_ROOT_PASSWORD} -e "CREATE USER IF NOT EXISTS '${DB_USER}'@'localhost' IDENTIFIED BY '${DB_PASSWORD}';"

# Grant necessary privileges to the user (adjust privileges as needed)
sudo mysql -u root -p${DB_ROOT_PASSWORD} -e "GRANT ALL PRIVILEGES ON *.* TO '${DB_USER}'@'localhost';"

# Flush privileges to apply changes
sudo mysql -u root -p${DB_ROOT_PASSWORD} -e "FLUSH PRIVILEGES;"

# Create the 'studentapp' database
sudo mysql -u ${DB_USER} -p${DB_PASSWORD} -e "CREATE DATABASE IF NOT EXISTS studentapp;"

# Create the 'students' table
sudo mysql -u ${DB_USER} -p${DB_PASSWORD} -e "CREATE TABLE IF NOT EXISTS students (
    student_id INT NOT NULL AUTO_INCREMENT,
    student_name VARCHAR(100) NOT NULL,
    student_addr VARCHAR(100) NOT NULL,
    student_age VARCHAR(3) NOT NULL,
    student_qual VARCHAR(20) NOT NULL,
    student_percent VARCHAR(10) NOT NULL,
    student_year_passed VARCHAR(10) NOT NULL,
    PRIMARY KEY (student_id)
);"

echo "Database setup completed successfully."
